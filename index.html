<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
    <div class="container">
        <h1 class="text-center mb-4">Todo List</h1>
        <div class="row">
            <div class="col-md-3">
                <input type="text" id="title" class="form-control mb-2" placeholder="Title">
            </div>
            <div class="col-md-3">
                <input type="text" id="note" class="form-control mb-2" placeholder="Note">
            </div>
            <div class="col-md-3">
                <input type="date" id="dueDate" class="form-control mb-2" placeholder="Due Date">
            </div>
            <div class="col-md-2">
                <select id="complete" class="form-control mb-2">
                    <option value="Yes">Yes</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div class="col-md-3">
                <select id="category" class="form-control mb-2">
                    <option value="General">General</option>
                    <option value="Body Exercise">Body Exercise</option>
                    <option value="Learning">Learning</option>
                    <option value="Chores">Chores</option>
                </select>
            </div>
            <div class="col-md-1">
                <button onclick="addTodo()" class="btn btn-primary mb-2">Add</button>
            </div>
        </div>
        <div id="todos"></div>
        <div id="details"></div>
    </div>

    <script>
        // Define the renderTodos function globally
        function renderTodos(todos) {
            const todosContainer = document.getElementById('todos');
            const detailsContainer = document.getElementById('details');

            todosContainer.innerHTML = '';
            detailsContainer.innerHTML = '';

            todos.forEach(todo => {
                const todoDiv = document.createElement('div');
                todoDiv.className = 'todo-item';

                const title = document.createElement('span');
                title.textContent = todo.title;
                title.addEventListener('click', () => showTodoDetails(todo.id));

                const updateButton = document.createElement('button');
                updateButton.textContent = 'Update';
                updateButton.addEventListener('click', () => updateTodoForm(todo.id));

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', () => deleteTodoConfirm(todo.id));

                todoDiv.appendChild(title);
                todoDiv.appendChild(updateButton);
                todoDiv.appendChild(deleteButton);
                todosContainer.appendChild(todoDiv);
            });
        }

        // Define the fetchTodos function globally
        function fetchTodos() {
            fetch('https://nicodeshub.com/todo_app/api/todo_list')
                .then(response => response.json())
                .then(data => {
                    renderTodos(data); // Call renderTodos to display fetched todos
                })
                .catch(error => console.error('Error fetching todos:', error));
        }

        // Define the addTodo function globally
        function addTodo() {
            const titleInput = document.getElementById('title').value;
            const noteInput = document.getElementById('note').value;
            const dueDateInput = new Date(document.getElementById('dueDate').value);
            const completeInput = document.getElementById('complete').value;
            const categoryInput = document.getElementById('category').value;

            // Format date as YYYY-MM-DD
            const formattedDueDate = dueDateInput.toISOString().split('T')[0];

            const newTodo = {
                title: titleInput,
                note: noteInput,
                date_due: formattedDueDate,
                complete: completeInput,
                category: categoryInput
            };

            fetch('https://nicodeshub.com/todo_app/api/add_todo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(newTodo),
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to add todo');
                }
                fetchTodos(); // Refresh the list after adding a new todo
            })
            .catch(error => console.error('Error adding todo:', error));
        }

        // Define the showTodoDetails function globally
        function showTodoDetails(id) {
            const detailsContainer = document.getElementById('details');
            fetch(`https://nicodeshub.com/todo_app/api/todo_details/${id}`)
                .then(response => response.json())
                .then(data => {
                    detailsContainer.innerHTML = `
                        <h2>${data.title}</h2>
                        <p>Note: ${data.note}</p>
                        <p>Due Date: ${data.date_due}</p>
                        <p>Complete: ${data.complete}</p>
                        <p>Category: ${data.category}</p>
                    `;
                })
                .catch(error => console.error('Error fetching todo details:', error));
        }

        // Define the updateTodoForm function globally
        function updateTodoForm(todoId) {
            const detailsContainer = document.getElementById('details');
            fetch(`https://nicodeshub.com/todo_app/api/todo_details/${todoId}`)
                .then(response => response.json())
                .then(todo => {
                    const updateTodoFormHTML = `
                        <h3>Update Todo</h3>
                        <div class="form-group">
                            <label for="updateTitle">Title:</label>
                            <input type="text" id="updateTitle" class="form-control" value="${todo.title}">
                        </div>
                        <div class="form-group">
                            <label for="updateNote">Note:</label>
                            <input type="text" id="updateNote" class="form-control" value="${todo.note}">
                        </div>
                        <div class="form-group">
                            <label for="updateDueDate">Due Date:</label>
                            <input type="date" id="updateDueDate" class="form-control" value="${todo.date_due}">
                        </div>
                        <div class="form-group">
                            <label for="updateComplete">Complete:</label>
                            <select id="updateComplete" class="form-control">
                                <option value="Yes" ${todo.complete === 'Yes' ? 'selected' : ''}>Yes</option>
                                <option value="No" ${todo.complete === 'No' ? 'selected' : ''}>No</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="updateCategory">Category:</label>
                            <input type="text" id="updateCategory" class="form-control" value="${todo.category}">
                        </div>
                        <button onclick="submitUpdate(${todo.id})" class="btn btn-primary">Update</button>
                    `;

                    detailsContainer.innerHTML = updateTodoFormHTML;
                })
                .catch(error => console.error('Error fetching todo details:', error));
        }
        // Define the submitUpdate function
        function submitUpdate(todoId) {
            // Write your update logic here
            console.log("Updating todo with ID:", todoId);
        }
        // Define the deleteTodoConfirm function globally
        function deleteTodoConfirm(id) {
            const confirmDelete = confirm('Are you sure you want to delete this todo?');
            if (confirmDelete) {
                deleteTodo(id);
            }
        }

        // Define the deleteTodo function globally
        function deleteTodo(id) {
            fetch(`https://nicodeshub.com/todo_app/api/delete_todo/${id}`, {
                method: 'DELETE',
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to delete todo');
                }
                fetchTodos(); // Refresh the list after deleting a todo
            })
            .catch(error => console.error('Error deleting todo:', error));
        }

        // Initial fetch of todos when the DOM content is loaded
        document.addEventListener("DOMContentLoaded", function() {
            fetchTodos();
        });
    </script>
</body>
</html>
