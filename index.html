<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo List</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>

<section class="vh-100 gradient-custom-2">
  <div class="container py-5 h-100">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col-md-12 col-xl-10">

        <div class="card mask-custom">
          <div class="card-body p-4 text-white">

            <div class="text-center pt-3 pb-2">
              <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-todo-list/check1.webp"
                alt="Check" width="60">
              <h2 class="my-4">Todo List</h2>
              <button onclick="showAddTodoForm()" class="btn btn-primary mb-3">Add Todo</button>
            </div>

            <div id="addTodoForm" style="display: none;">
                <div class="form-group">
                    <input type="text" id="title" class="form-control mb-2" placeholder="Title">
                </div>
                <div class="form-group">
                    <input type="text" id="note" class="form-control mb-2" placeholder="Note">
                </div>
                <div class="form-group">
                    <input type="date" id="dueDate" class="form-control mb-2" placeholder="Due Date">
                </div>
                <div class="form-group">
                    <select id="complete" class="form-control mb-2">
                        <option value="Yes">Yes</option>
                        <option value="No">No</option>
                    </select>
                </div>
                <div class="form-group">
                    <select id="category" class="form-control mb-2">
                        <option value="General">General</option>
                        <option value="Body Exercise">Body Exercise</option>
                        <option value="Learning">Learning</option>
                        <option value="Chores">Chores</option>
                    </select>
                </div>
                <div class="form-group">
                    <button onclick="addTodo()" class="btn btn-primary mb-2">Add</button>
                    <button onclick="hideAddTodoForm()" class="btn btn-secondary mb-2 ms-2">Cancel</button>
                </div>
            </div>

            <div id="updateTodoForm" style="display: none;"></div>

            <table class="table text-white mb-0">
              <thead>
                <tr>
                  <th scope="col">Title</th>
                  <th scope="col">Note</th>
                  <th scope="col">Due Date</th>
                  <th scope="col">Status</th>
                  <th scope="col">Category</th>
                  <th scope="col">Actions</th>
                </tr>
              </thead>
              <tbody id="todos">
                <!-- Todo items will be rendered here -->
              </tbody>
            </table>

            <div id="details"></div>

            <div id="successMessage" class="alert alert-success mt-3" style="display: none;">
                <strong>Success!</strong> <span id="successMessageText"></span>
            </div>

          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<script>
    let addTodoFormVisible = false;
    let updateTodoFormVisible = false;

    // JavaScript code remains the same
    // Define the renderTodos function globally
    function renderTodos(todos) {
        const todosContainer = document.getElementById('todos');
        const detailsContainer = document.getElementById('details');

        todosContainer.innerHTML = '';
        detailsContainer.innerHTML = '';

        todos.forEach(todo => {
            const todoTr = document.createElement('tr');

            const titleTd = document.createElement('td');
            titleTd.textContent = todo.title;

            const noteTd = document.createElement('td');
            noteTd.textContent = todo.note;

            const dueDateTd = document.createElement('td');
            dueDateTd.textContent = todo.date_due;

            const statusTd = document.createElement('td');
            statusTd.textContent = todo.complete;

            const categoryTd = document.createElement('td');
            categoryTd.textContent = todo.category;

            const actionsTd = document.createElement('td');
            const updateButton = document.createElement('button');
            updateButton.textContent = 'Update';
            updateButton.classList.add('btn', 'btn-primary', 'me-2');
            updateButton.addEventListener('click', () => showUpdateTodoForm(todo));

            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Delete';
            deleteButton.classList.add('btn', 'btn-danger');
            deleteButton.addEventListener('click', () => deleteTodoConfirm(todo.id));

            actionsTd.appendChild(updateButton);
            actionsTd.appendChild(deleteButton);

            todoTr.appendChild(titleTd);
            todoTr.appendChild(noteTd);
            todoTr.appendChild(dueDateTd);
            todoTr.appendChild(statusTd);
            todoTr.appendChild(categoryTd);
            todoTr.appendChild(actionsTd);

            todosContainer.appendChild(todoTr);
        });
    }

    // Function to show the add todo form
    function showAddTodoForm() {
        if (!addTodoFormVisible && !updateTodoFormVisible) {
            const addTodoForm = document.getElementById('addTodoForm');
            addTodoForm.style.display = 'block';
            addTodoFormVisible = true;
        }
    }

    // Function to show the update todo form
    function showUpdateTodoForm(todo) {
        if (!updateTodoFormVisible && !addTodoFormVisible) {
            const updateTodoForm = document.getElementById('updateTodoForm');
            updateTodoForm.innerHTML = `
                <h3>Update Todo</h3>
                <div class="form-group">
                    <label for="updateTitle">Title:</label>
                    <input type="text" id="updateTitle" class="form-control" value="${todo.title}">
                </div>
                <div class="form-group">
                    <label for="updateNote">Note:</label>
                    <input type="text" id="updateNote" class="form-control" value="${todo.note}">
                </div>
                <div class="form-group">
                    <label for="updateDueDate">Due Date:</label>
                    <input type="date" id="updateDueDate" class="form-control" value="${todo.date_due}">
                </div>
                <div class="form-group">
                    <label for="updateComplete">Complete:</label>
                    <select id="updateComplete" class="form-control">
                        <option value="Yes" ${todo.complete === 'Yes' ? 'selected' : ''}>Yes</option>
                        <option value="No" ${todo.complete === 'No' ? 'selected' : ''}>No</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="updateCategory">Category:</label>
                    <input type="text" id="updateCategory" class="form-control" value="${todo.category}">
                </div>
                <button onclick="submitUpdate(${todo.id})" class="btn btn-primary">Update</button>
                <button onclick="hideUpdateTodoForm()" class="btn btn-secondary">Cancel</button>
            `;
            updateTodoForm.style.display = 'block';
            updateTodoFormVisible = true;
        }
    }

    // Function to hide the add todo form
    function hideAddTodoForm() {
        const addTodoForm = document.getElementById('addTodoForm');
        addTodoForm.style.display = 'none';
        addTodoFormVisible = false;
    }

    // Function to hide the update todo form
    function hideUpdateTodoForm() {
        const updateTodoForm = document.getElementById('updateTodoForm');
        updateTodoForm.innerHTML = ''; // Clear the update form content
        updateTodoForm.style.display = 'none';
        updateTodoFormVisible = false;
    }

    // Define the fetchTodos function globally
    function fetchTodos() {
        fetch('https://nicodeshub.com/todo_app/api/todo_list')
            .then(response => response.json())
            .then(data => {
                renderTodos(data); // Call renderTodos to display fetched todos
            })
            .catch(error => console.error('Error fetching todos:', error));
    }

    // Define the addTodo function globally
    function addTodo() {
        const titleInput = document.getElementById('title').value;
        const noteInput = document.getElementById('note').value;
        const dueDateInput = new Date(document.getElementById('dueDate').value);
        const completeInput = document.getElementById('complete').value;
        const categoryInput = document.getElementById('category').value;

        // Format date as YYYY-MM-DD
        const formattedDueDate = dueDateInput.toISOString().split('T')[0];

        const newTodo = {
            title: titleInput,
            note: noteInput,
            date_due: formattedDueDate,
            complete: completeInput,
            category: categoryInput
        };

        fetch('https://nicodeshub.com/todo_app/api/add_todo', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(newTodo),
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to add todo');
            }
            fetchTodos(); // Refresh the list after adding a new todo
            hideAddTodoForm(); // Hide the add todo form after successful submission
            showSuccessMessage('Todo added successfully!');
        })
        .catch(error => console.error('Error adding todo:', error));
    }

    // Define the submitUpdate function
    function submitUpdate(todoId) {
        // Write your update logic here
        console.log("Updating todo with ID:", todoId);
        hideUpdateTodoForm(); // Hide the update todo form after successful submission
        showSuccessMessage('Todo updated successfully!');
    }

    // Define the deleteTodoConfirm function globally
    function deleteTodoConfirm(id) {
        const confirmDelete = confirm('Are you sure you want to delete this todo?');
        if (confirmDelete) {
            deleteTodo(id);
        }
    }

    // Define the deleteTodo function globally
    function deleteTodo(id) {
        fetch(`https://nicodeshub.com/todo_app/api/delete_todo/${id}`, {
            method: 'DELETE',
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to delete todo');
            }
            fetchTodos(); // Refresh the list after deleting a todo
            showSuccessMessage('Todo deleted successfully!');
        })
        .catch(error => console.error('Error deleting todo:', error));
    }

    // Function to show success message
    function showSuccessMessage(message) {
        const successMessageText = document.getElementById('successMessageText');
        successMessageText.textContent = message;
        const successMessage = document.getElementById('successMessage');
        successMessage.style.display = 'block';
        setTimeout(() => {
            successMessage.style.display = 'none';
        }, 3000); // Hide the message after 3 seconds
    }

    // Initial fetch of todos when the DOM content is loaded
    document.addEventListener("DOMContentLoaded", function() {
        fetchTodos();
    });
</script>

</body>
</html>
